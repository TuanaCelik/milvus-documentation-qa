{"content": "<iframe src=\"https://www.googletagmanager.com/ns.html?id=G-V1G3KQ048M\" height=\"0\" width=\"0\" style=\"display: none; visibility: hidden\" aria-hidden=\"true\"></iframe>DocsTutorialsToolsBlogCommunityTry Managed Milvus FREEDocsTutorialsToolsBlogCommunityStars22kJoin SlackTry Managed Milvus FREEHow we use cookiesThis website stores cookies on your computer. By continuing to browse or by clicking \u2018Accept\u2019, you agree to the storing of cookies on your device to enhance your site experience and for analytical purposes.AcceptSearch\u2318KHomev2.2.x\u200bAbout MilvusGet StartedUser GuideAdministration GuideConfigure MilvusManage DependenciesAllocate ResourcesDeploy on CloudsScale a Milvus ClusterManage Resource GroupsUpgradeUpgrade Milvus ClusterUpgrade Milvus StandaloneMonitor and AlertSecurityIntegrationsBenchmarksToolsReferenceExample ApplicationsFAQsAPI referenceMilvus OperatorHelm\nUpgrade Milvus Cluster with Helm Chart\nThis guide describes how to upgrade your Milvus cluster with Milvus Helm charts.\nCheck Milvus Helm Chart\nRun the following commands to check new Milvus versions.\n$ helm repo update\n$ helm search repo milvus --versions\n\nNAME            CHART VERSION   APP VERSION             DESCRIPTION \nmilvus/milvus   4.0.26          2.2.11                  Milvus is an open-source vector database built ...                                      \nmilvus/milvus   4.0.25          2.2.10                  Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.24          2.2.9                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.23          2.2.9                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.22          2.2.8                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.21          2.2.8                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.20          2.2.8                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.19          2.2.7                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.17          2.2.6                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.16          2.2.6                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.14          2.2.5                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.13          2.2.5                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.12          2.2.4                   Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.11          2.3.0-beta              Milvus is an open-source vector database built ...\nmilvus/milvus   4.0.10          2.2.3                   Milvus is an open-source vector database built ...\n\nYou can choose the upgrade path for your Milvus as follows:\n\nConduct a rolling upgrade from Milvus v2.2.3 and later releases to v2.2.12.\nUpgrade Milvus using Helm for an upgrade from a minor release before v2.2.3 to v2.2.12.\nMigrate the metadata before the upgrade from Milvus v2.1.x to v2.2.12.\n\n\nConduct a rolling upgrade\nSince Milvus 2.2.3, you can configure Milvus coordinators to work in active-standby mode and enable the rolling upgrade feature for them, so that Milvus can respond to incoming requests during the coordinator upgrades. In previous releases, coordinators are to be removed and then created during an upgrade, which may introduce certain downtime of the service.\nRolling upgrades requires coordinators to work in active-standby mode. You can use the script we provide to configure the coordinators to work in active-standby mode and start the rolling upgrade.\nBased on the rolling update capabilities provided by Kubernetes, the above script enforces an ordered update of the deployments according to their dependencies. In addition, Milvus implements a mechanism to ensure that its components remain compatible with those depending on them during the upgrade, significantly reducing potential service downtime.\nThe script applies only to the upgrade of Milvus installed with Helm. The following table lists the command flags available in the scripts.\n\n\n\nParameters\nDescription\nDefault value\nRequired\n\n\n\n\ni\nMilvus instance name\nNone\nTrue\n\n\nn\nNamespace that Milvus is installed in\ndefault\nFalse\n\n\nt\nTarget Milvus version\nNone\nTrue\n\n\nw\nNew Milvus image tag\nmilvusdb/milvus:v2.2.3\nTrue\n\n\no\nOperation\nupdate\nFalse\n\n\n\nOnce you have ensured that all deployments in your Milvus instance are in their normal status. You can run the following command to upgrade the Milvus instance to 2.2.12.\nsh rollingUpdate.sh -n default -i my-release -o update -t 2.2.12 -w 'milvusdb/milvus:v2.2.12'\n\n\n\nThe script hard-codes the upgrade order of the deployments and cannot be changed.\nThe script uses kubectl patch to update the deployments and kubectl rollout status to watch their status.\nThe script uses kubectl patch to update the app.kubernetes.io/version label of the deployments to the one specified after the -t flag in the command.\n\n\n\nUpgrade Milvus using Helm\nTo upgrade Milvus from a minor release before v2.2.3 to the latest, run the following commands:\nhelm repo update\nhelm upgrade my-release milvus/milvus --reuse-values --version=4.0.26 # use the helm chart version here\n\nUse the Helm chart version in the preceding command. For details on how to obtain the Helm chart version, refer to Check the Milvus version.\nMigrate the metadata\nSince Milvus 2.2.0, the metadata is incompatible with that in previous releases. The following example snippets assume an upgrade from Milvus 2.1.4 to Milvus 2.2.0.\n1. Check the Milvus version\nRun $ helm list to check your Milvus app version. You can see the APP VERSION is 2.1.4.\nNAME             \tNAMESPACE\tREVISION\tUPDATED                                \tSTATUS  \tCHART        \tAPP VERSION    \nnew-release      \tdefault  \t1       \t2022-11-21 15:41:25.51539 +0800 CST    \tdeployed\tmilvus-3.2.18\t2.1.4 \n\n2. Check the running pods\nRun $ kubectl get pods to check the running pods. You can see the following output.\nNAME                                             READY   STATUS      RESTARTS   AGE\nmy-release-etcd-0                               1/1     Running     0          21m\nmy-release-etcd-1                               1/1     Running     0          21m\nmy-release-etcd-2                               1/1     Running     0          21m\nmy-release-milvus-datacoord-664c58798d-fl75s    1/1     Running     0          21m\nmy-release-milvus-datanode-5f75686c55-xfg2r     1/1     Running     0          21m\nmy-release-milvus-indexcoord-5f98b97589-2l48r   1/1     Running     0          21m\nmy-release-milvus-indexnode-857b4ddf98-vmd75    1/1     Running     0          21m\nmy-release-milvus-proxy-6c548f787f-scspp        1/1     Running     0          21m\nmy-release-milvus-querycoord-c454f44cd-dwmwq    1/1     Running     0          21m\nmy-release-milvus-querynode-76bb4946d-lbrz6     1/1     Running     0          21m\nmy-release-milvus-rootcoord-7764c5b686-62msm    1/1     Running     0          21m\nmy-release-minio-0                              1/1     Running     0          21m\nmy-release-minio-1                              1/1     Running     0          21m\nmy-release-minio-2                              1/1     Running     0          21m\nmy-release-minio-3                              1/1     Running     0          21m\nmy-release-pulsar-bookie-0                      1/1     Running     0          21m\nmy-release-pulsar-bookie-1                      1/1     Running     0          21m\nmy-release-pulsar-bookie-2                      1/1     Running     0          21m\nmy-release-pulsar-bookie-init-tjxpj             0/1     Completed   0          21m\nmy-release-pulsar-broker-0                      1/1     Running     0          21m\nmy-release-pulsar-proxy-0                       1/1     Running     0          21m\nmy-release-pulsar-pulsar-init-c8vvc             0/1     Completed   0          21m\nmy-release-pulsar-recovery-0                    1/1     Running     0          21m\nmy-release-pulsar-zookeeper-0                   1/1     Running     0          21m\nmy-release-pulsar-zookeeper-1                   1/1     Running     0          20m\nmy-release-pulsar-zookeeper-2                   1/1     Running     0          20m\n\n3. Check the image tag\nCheck the image tag for the pod my-release-milvus-proxy-6c548f787f-scspp. You can see the release of your Milvus cluster is v2.1.4.\n$ kubectl get pods my-release-milvus-proxy-6c548f787f-scspp -o=jsonpath='{$.spec.containers[0].image}'\n# milvusdb/milvus:v2.1.4\n\n4. Migrate the metadata\nA major change in Milvus 2.2 is the metadata structure of segment indexes. Therefore, you need to use Helm to migrate the metadata while upgrading Milvus from v2.1.x to v2.2.0. Here is a script for you to safely migrate your metadata.\nThis script only applies to Milvus installed on a K8s cluster. Roll back to the previous version with the rollback operation first if an error occurs during the process.\nThe following table lists the operations you can do for meta migration.\n\n\n\nParameters\nDescription\nDefault value\nRequired\n\n\n\n\ni\nThe Milvus instance name.\nNone\nTrue\n\n\nn\nThe namespace that Milvus is installed in.\ndefault\nFalse\n\n\ns\nThe source Milvus version.\nNone\nTrue\n\n\nt\nThe target Milvus version.\nNone\nTrue\n\n\nr\nThe root path of Milvus meta.\nby-dev\nFalse\n\n\nw\nThe new Milvus image tag.\nmilvusdb/milvus:v2.2.0\nFalse\n\n\nm\nThe meta migration image tag.\nmilvusdb/meta-migration:v2.2.0\nFalse\n\n\no\nThe meta migration operation.\nmigrate\nFalse\n\n\nd\nWhether to delete migration pod after the migration is completed.\nfalse\nFalse\n\n\nc\nThe storage class for meta migration pvc.\ndefault storage class\nFalse\n\n\ne\nThe etcd enpoint used by milvus.\netcd svc installed with milvus\nFalse\n\n\n\n1. Migrate the metadata\n\nDownload the migration script.\nStop the Milvus components. Any live session in the Milvus etcd can cause a migration failure.\nCreate a backup for the Milvus metadata.\nMigrate the Milvus metadata.\nStart Milvus components with a new image.\n\n2. Upgrade Milvus from v2.1.x to 2.2.12\nThe following commands assume that you upgrade Milvus from v2.1.4 to 2.2.12. Change them to the versions that fit your needs.\n\n\nSpecify Milvus instance name, source Milvus version, and target Milvus version.\n./migrate.sh -i my-release -s 2.1.4 -t 2.2.12\n\n\n\nSpecify the namespace with -n if your Milvus is not installed in the default K8s namespace.\n./migrate.sh -i my-release -n milvus -s 2.1.4 -t 2.2.12\n\n\n\nSpecify the root path with -r if your Milvus is installed with the custom rootpath.\n./migrate.sh -i my-release -n milvus -s 2.1.4 -t 2.2.12 -r by-dev\n\n\n\nSpecify the image tag with -w if your Milvus is installed with a custom image.\n./migrate.sh -i my-release -n milvus -s 2.1.4 -t 2.2.12 -r by-dev -w milvusdb/milvus:v2.2.12\n\n\n\nSet -d true if you want to automatically remove the migration pod after the migration is completed.\n./migrate.sh -i my-release -n milvus -s 2.1.4 -t 2.2.12 -w milvusdb/milvus:v2.2.12 -d true\n\n\n\nRollback and migrate again if the migration fails.\n./migrate.sh -i my-release -n milvus -s 2.1.4 -t 2.2.12 -r by-dev -o rollback -w milvusdb/milvus:v2.1.1\n./migrate.sh -i my-release -n milvus -s 2.1.4 -t 2.2.12 -r by-dev -o migrate -w milvusdb/milvus:v2.2.12\n\n\nupgrade_milvus_cluster-helm.md was last updated at 2023-06-29 18:34:00: doc release for 2.2.11Edit this pageReport a bugRequest doc changesOn this pageUpgrade Milvus Cluster with Helm ChartCheck Milvus Helm ChartConduct a rolling upgradeUpgrade Milvus using HelmMigrate the metadataResourcesDocsBlogManaged serviceTutorialsBootcampDemoVideoToolsAttuMilvus CLISizing ToolMivlus backup ToolCommunityGet involvedSlackGithubForumMilvus. 2023 All rights reserved./*<![CDATA[*/window.pagePath=\"/docs/upgrade_milvus_cluster-helm.md\";/*]]>*//*<![CDATA[*/window.___chunkMapping={\"polyfill\":[\"/polyfill.js\"],\"app\":[\"/app.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js.js\",\"/component---src-pages-404-js.ffef32ceb6972d1b6709.css\"],\"component---src-pages-bootcamp-jsx\":[\"/component---src-pages-bootcamp-jsx.js\",\"/component---src-pages-bootcamp-jsx.edf1a55d3c49094e9b41.css\"],\"component---src-pages-community-index-jsx\":[\"/component---src-pages-community-index-jsx.js\",\"/component---src-pages-community-index-jsx.c505d2a5fff7c1e4b2c8.css\"],\"component---src-pages-index-jsx\":[\"/component---src-pages-index-jsx.js\",\"/component---src-pages-index-jsx.45df0d4bdfe2db469d6c.css\"],\"component---src-pages-milvus-demos-index-jsx\":[\"/component---src-pages-milvus-demos-index-jsx.js\",\"/component---src-pages-milvus-demos-index-jsx.1a3d1c4caf417de255ae.css\"],\"component---src-pages-milvus-demos-reverse-image-search-jsx\":[\"/component---src-pages-milvus-demos-reverse-image-search-jsx.js\",\"/component---src-pages-milvus-demos-reverse-image-search-jsx.c41e4c5ead83649937e8.css\"],\"component---src-pages-slack-jsx\":[\"/component---src-pages-slack-jsx.js\",\"/component---src-pages-slack-jsx.b3b356986d01fe89f9d1.css\"],\"component---src-pages-tools-sizing-jsx\":[\"/component---src-pages-tools-sizing-jsx.js\",\"/component---src-pages-tools-sizing-jsx.66d1c05015f9508df90b.css\"],\"component---src-templates-api-doc-template-jsx\":[\"/component---src-templates-api-doc-template-jsx.js\",\"/component---src-templates-api-doc-template-jsx.6c57c73b99682695a5ef.css\"],\"component---src-templates-blog-list-template-jsx\":[\"/component---src-templates-blog-list-template-jsx.js\",\"/component---src-templates-blog-list-template-jsx.71f592374d478c258caf.css\"],\"component---src-templates-blog-template-jsx\":[\"/component---src-templates-blog-template-jsx.js\",\"/component---src-templates-blog-template-jsx.5068317f62135173b013.css\"],\"component---src-templates-doc-template-jsx\":[\"/component---src-templates-doc-template-jsx.js\",\"/component---src-templates-doc-template-jsx.0e85fbce360982ff881c.css\"]};/*]]>*/", "content_type": "text", "score": null, "meta": {"url": "https://milvus.io/docs/upgrade_milvus_cluster-helm.md"}, "id_hash_keys": ["content"], "embedding": null, "id": "dcd14361f8dd3b95e36b79d73953a6bd"}